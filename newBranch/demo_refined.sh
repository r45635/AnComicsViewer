#!/bin/bash
# Script de d√©monstration du post-traitement raffin√©

echo "üéØ D√©monstration du post-traitement raffin√© AnComicsViewer"
echo "=========================================================="
echo ""
echo "Le post-traitement raffin√© apporte les am√©liorations suivantes:"
echo ""
echo "‚úÖ FILTRAGE INTELLIGENT:"
echo "   ‚Ä¢ Seuils de confiance par classe (panels vs balloons)"
echo "   ‚Ä¢ Filtrage par taille minimale/maximale"
echo "   ‚Ä¢ Exclusion des d√©tections en bord de page"
echo "   ‚Ä¢ NMS s√©par√©e par classe (√©vite la suppression inter-classe)"
echo ""
echo "‚úÖ R√àGLES S√âMANTIQUES:"
echo "   ‚Ä¢ Les balloons doivent √™tre attach√©s √† des panels"
echo "   ‚Ä¢ Limitation du nombre total de d√©tections"
echo "   ‚Ä¢ Priorisation par taille et confiance"
echo ""
echo "‚úÖ M√âTRIQUES DE QUALIT√â:"
echo "   ‚Ä¢ Score de qualit√© automatique (0-1)"
echo "   ‚Ä¢ D√©tection des overlaps et severe overlaps"
echo "   ‚Ä¢ Export JSON optionnel pour analyse"
echo ""

echo "üß™ Test du post-traitement..."
python3 test_refined_postproc.py

echo ""
echo "üìä Configuration utilis√©e:"
echo "-------------------------"
echo "Param√®tres cl√©s du YAML (config/detect_with_merge.yaml):"
echo ""
echo "# Seuils par classe"
echo "panel_conf: $(grep '^panel_conf:' config/detect_with_merge.yaml | cut -d' ' -f2)"
echo "balloon_conf: $(grep '^balloon_conf:' config/detect_with_merge.yaml | cut -d' ' -f2)"
echo ""
echo "# NMS par classe"
echo "panel_nms_iou: $(grep '^panel_nms_iou:' config/detect_with_merge.yaml | cut -d' ' -f2)"
echo "balloon_nms_iou: $(grep '^balloon_nms_iou:' config/detect_with_merge.yaml | cut -d' ' -f2)"
echo ""
echo "# Limites de quantit√©"
echo "max_panels: $(grep '^max_panels:' config/detect_with_merge.yaml | cut -d' ' -f2)"
echo "max_balloons: $(grep '^max_balloons:' config/detect_with_merge.yaml | cut -d' ' -f2)"
echo ""
echo "# Attachement balloon‚Üípanel"
echo "balloon_min_overlap_panel: $(grep '^balloon_min_overlap_panel:' config/detect_with_merge.yaml | cut -d' ' -f2)"

echo ""
echo "üí° UTILISATION:"
echo "---------------"
echo ""
echo "Pour tester avec un vrai PDF:"
echo ""
echo "1. Avec m√©triques export:"
echo "   python3 main.py --config config/detect_with_merge.yaml \\"
echo "                   --metrics-out metrics.json \\"
echo "                   --debug-detect"
echo ""
echo "2. Avec debug visuel:"
echo "   python3 main.py --debug-detect --save-debug-overlays debug"
echo ""
echo "3. Traitement batch (script):"
echo "   for page in {0..5}; do"
echo "     python3 main.py --page \$page --metrics-out batch.json"
echo "   done"
echo ""

echo "üéØ R√âSULTATS ATTENDUS:"
echo "----------------------"
echo "‚Ä¢ ‚¨áÔ∏è  R√©duction significative des d√©tections parasites"
echo "‚Ä¢ üéà Balloons mieux attach√©s aux panels"
echo "‚Ä¢ üìä Score de qualit√© plus √©lev√©"
echo "‚Ä¢ üñºÔ∏è  Overlays de debug plus propres"
echo "‚Ä¢ üìà M√©triques d√©taill√©es en JSON"

echo ""
echo "‚úÖ Post-traitement raffin√© pr√™t √† utiliser!"
